# SSD1306 OLEDディスプレイライブラリ 使用方法

## 概要

このライブラリは、SSD1306コントローラーを使用した128×64ピクセル及び128x32ピクセルの単色OLEDディスプレイ用の高性能グラフィックスライブラリです。様々なマイコンで使用できるように最適化されており、I2C通信によるディスプレイ制御と豊富な描画機能を提供します。

## 主な特徴

- **高速描画**: 最適化されたアルゴリズムによる高速グラフィックス描画
- **ダブルバッファリング**: スムーズなアニメーション表示
- **差分更新**: 変更された部分のみを更新する効率的な転送
- **豊富な描画機能**: 基本図形からテキスト表示まで
- **メモリ効率**: 1kバイト×2のダブルバッファ構成

## 初期化

### 1. ライブラリの初期化

```c
#include "ssd1306.h"

// ディスプレイの初期化
SSD1306_Init();
```

### 2. 画面のクリア

```c
// 画面全体をクリア
SSD1306_Clear();

// 変更をディスプレイに反映
SSD1306_Update();
```

## 基本的な描画機能

### ピクセルの描画

```c
// 座標(x, y)にピクセルを描画
// color: 1=点灯, 0=消灯
SSD1306_DrawPixel(50, 30, 1);
```

### 線の描画

```c
// 2点間に線を描画
SSD1306_DrawLine(0, 0, 127, 63, 1);  // 対角線
SSD1306_DrawLine(0, 32, 127, 32, 1); // 水平線
SSD1306_DrawLine(64, 0, 64, 63, 1);  // 垂直線
```

### 矩形の描画

```c
// 矩形の枠を描画
SSD1306_DrawRect(10, 10, 50, 30, 1);

// 塗りつぶし矩形を描画
SSD1306_FillRect(70, 10, 50, 30, 1);
```

### 円の描画

```c
// 円の枠を描画
SSD1306_DrawCircle(64, 32, 20, 1);

// 塗りつぶし円を描画
SSD1306_FillCircle(64, 32, 15, 1);
```

### 楕円の描画

```c
// 楕円を描画（x0, y0を中心とした幅x1, 高さy1の楕円）
SSD1306_DrawEllipse(30, 20, 40, 24, 1);

// 塗りつぶし楕円を描画
SSD1306_FillEllipse(30, 20, 40, 24, 1);
```

### 三角形の描画

```c
// 三角形の枠を描画
SSD1306_DrawTriangle(64, 10, 40, 50, 88, 50, 1);

// 塗りつぶし三角形を描画
SSD1306_FillTriangle(64, 10, 40, 50, 88, 50, 1);
```

### 角丸矩形の描画

```c
// 角丸矩形の枠を描画
SSD1306_DrawRoundRect(10, 10, 50, 30, 5, 1);

// 塗りつぶし角丸矩形を描画
SSD1306_FillRoundRect(70, 10, 50, 30, 5, 1);
```

## テキスト表示

### ASCII文字の表示

```c
// 1文字を表示
SSD1306_DrawChar(0, 0, 'A', 1);

// 文字列を表示
SSD1306_DrawString(0, 10, "Hello World!", 1);
```

### 文字表示

```c
// UTF-8エンコードされた文字を表示
SSD1306_DrawChar(0, 20, "α", 1);

// UTF-8文字列の表示
SSD1306_DrawString(0, 30, "π=3.14159", 1); // πマークを含む文字列
```

## ディスプレイ制御

### 表示のON/OFF

```c
// ディスプレイを点灯
SSD1306_DisplayOn();

// ディスプレイを消灯
SSD1306_DisplayOff();
```

### 表示モードの切り替え

```c
// 通常表示
SSD1306_DisplayNormal();

// 反転表示（白黒反転）
SSD1306_DisplayInverse();

// 全画面点灯
SSD1306_DisplayAllOn();
```

### コントラスト調整

```c
// コントラストを設定（0-255）
SSD1306_SetContrast(128); // 中間値
SSD1306_SetContrast(255); // 最大値
```

## バッファ管理

### ダブルバッファリング

```c
// 描画処理
SSD1306_DrawCircle(64, 32, 20, 1);
SSD1306_DrawString(10, 10, "Frame 1", 1);

// バッファを切り替え（スムーズなアニメーション用）
SSD1306_Buffer_swap();

// 変更をディスプレイに反映
SSD1306_Update();
```

### 画面更新の最適化

```c
// 差分更新（変更部分のみ更新）
SSD1306_Update();

// 強制全画面更新
SSD1306_Update_Full();
```

## 実用的な使用例

### 1. シンプルな時計表示

```c
void draw_clock(int hour, int minute, int second) {
    char time_str[16];
    
    SSD1306_Clear();
    
    // 時刻を文字列に変換
    sprintf(time_str, "%02d:%02d:%02d", hour, minute, second);
    
    // 画面中央に時刻を表示
    SSD1306_DrawString(32, 28, time_str, 1);
    
    SSD1306_Update();
}
```

### 2. グラフ表示

```c
void draw_graph(uint8_t *data, uint8_t data_count) {
    SSD1306_Clear();
    
    // 枠を描画
    SSD1306_DrawRect(0, 0, 128, 64, 1);
    
    // データポイントを線で接続
    for (uint8_t i = 0; i < data_count - 1; i++) {
        uint8_t x1 = i * 127 / (data_count - 1);
        uint8_t y1 = 63 - (data[i] * 62 / 255);
        uint8_t x2 = (i + 1) * 127 / (data_count - 1);
        uint8_t y2 = 63 - (data[i + 1] * 62 / 255);
        
        SSD1306_DrawLine(x1, y1, x2, y2, 1);
    }
    
    SSD1306_Update();
}
```

### 3. メニュー表示

```c
void draw_menu(const char **items, uint8_t item_count, uint8_t selected) {
    SSD1306_Clear();
    
    // タイトル
    SSD1306_DrawString(40, 0, "MENU", 1);
    SSD1306_DrawLine(0, 10, 127, 10, 1);
    
    // メニュー項目
    for (uint8_t i = 0; i < item_count; i++) {
        uint8_t y = 16 + i * 12;
        
        // 選択項目を反転表示
        if (i == selected) {
            SSD1306_FillRect(0, y - 1, 128, 10, 1);
            SSD1306_DrawString(8, y, items[i], 0); // 黒文字
        } else {
            SSD1306_DrawString(8, y, items[i], 1); // 白文字
        }
    }
    
    SSD1306_Update();
}
```

## パフォーマンス最適化のヒント

1. **差分更新の活用**: 頻繁な更新では`SSD1306_Update()`を使用し、必要時のみ`SSD1306_Update_Full()`を使用
2. **ダブルバッファリング**: スムーズなアニメーションには`SSD1306_Buffer_swap()`を活用
3. **不要な描画の回避**: 前回と同じ内容の場合は描画をスキップ
4. **一括描画**: 複数の図形を描画後に一度だけ`SSD1306_Update()`を呼び出す

## 座標系とサイズ

- **画面サイズ**: 128×64ピクセル
- **座標系**: 左上が原点(0,0)、右下が(127,63)
- **フォントサイズ**: 1文字8×8ピクセル
- **色**: 1=点灯、0=消灯

## 注意事項

1. 座標が画面範囲外の場合、自動的に無視されます
2. すべての描画はバッファに対して行われ、`SSD1306_Update()`で実際の画面に反映されます
3. 文字は事前定義された文字のみ表示可能です
4. I2C通信エラーが発生した場合、HAL層で適切に処理されるようにしてください

このライブラリを使用することで、高品質で効率的なOLEDディスプレイアプリケーションを簡単に開発できます。